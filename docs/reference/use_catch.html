<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Use Catch for C++ Unit Testing — use_catch • testthat</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>

<!-- Bootstrap -->
<link href="../tidyverse.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- tidyverse -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>

<!-- mathjax -->
<script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">testthat</a>
        <small class="tidyverse">part of the <a href="http://tidyverse.org">tidyverse</a></small>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
        <li>
  <a href="https://github.com/r-lib/testthat">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Use Catch for C++ Unit Testing</h1>
    </div>

    
    <p>Add the necessary infrastructure to enable C++ unit testing
in <span style="R">R</span> packages with
<a href='https://github.com/philsquared/Catch'>Catch</a> and <code>testthat</code>.</p>
    

    <pre class="usage"><span class='fu'>use_catch</span>(<span class='kw'>dir</span> <span class='kw'>=</span> <span class='fu'>getwd</span>())</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>dir</th>
      <td><p>The directory containing an <span style="R">R</span> package.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Calling <code>use_catch()</code> will:</p><ol>
<li><p>Create a file <code>src/test-runner.cpp</code>, which ensures that the
<code>testthat</code> package will understand how to run your package's
unit tests,</p></li>
<li><p>Create an example test file <code>src/test-example.cpp</code>, which
showcases how you might use Catch to write a unit test,</p></li>
<li><p>Add a test file <code>tests/testthat/test-cpp.R</code>, which ensures that
<code>testthat</code> will run your compiled tests during invocations of
<code><a href='http://www.rdocumentation.org/packages/devtools/topics/test'>devtools::test()</a></code> or <code>R CMD check</code>, and</p></li>
<li><p>Create a file <code>R/catch-routine-registration.R</code>, which ensures that
<span style="R">R</span> will automatically register this routine when
<code><a href='http://www.rdocumentation.org/packages/tools/topics/package_native_routine_registration_skeleton'>tools::package_native_routine_registration_skeleton()</a></code> is invoked.</p></li>
</ol>
    <p>C++ unit tests can be added to C++ source files within the
<code>src</code> directory of your package, with a format similar
to <span style="R">R</span> code tested with <code>testthat</code>. Here's a simple example
of a unit test written with <code>testthat</code> + Catch:</p><pre>
context("C++ Unit Test") {
  test_that("two plus two is four") {
    int result = 2 + 2;
    expect_true(result == 4);
  }
}
</pre>
    <p>When your package is compiled, unit tests alongside a harness
for running these tests will be compiled into your <span style="R">R</span> package,
with the C entry point <code>run_testthat_tests()</code>. <code>testthat</code>
will use that entry point to run your unit tests when detected.</p>
    
    <h2 class="hasAnchor" id="functions"><a class="anchor" href="#functions"></a>Functions</h2>

    
    <p>All of the functions provided by Catch are
available with the <code>CATCH_</code> prefix -- see
<a href='https://github.com/philsquared/Catch/blob/master/docs/assertions.md'>here</a>
for a full list. <code>testthat</code> provides the
following wrappers, to conform with <code>testthat</code>'s
<span style="R">R</span> interface:</p><table><tr><td>
<strong>Function</strong> </td>
<td> <strong>Catch</strong> </td>
<td> <strong>Description</strong> </td>
</tr><tr><td>
<code>context</code> </td>
<td> <code>CATCH_TEST_CASE</code> </td>
<td> The context of a set of tests. </td>
</tr><tr><td>
<code>test_that</code> </td>
<td> <code>CATCH_SECTION</code> </td>
<td> A test section. </td>
</tr><tr><td>
<code>expect_true</code> </td>
<td> <code>CATCH_CHECK</code> </td>
<td> Test that an expression evaluates to <code>true</code>. </td>
</tr><tr><td>
<code>expect_false</code> </td>
<td> <code>CATCH_CHECK_FALSE</code> </td>
<td> Test that an expression evalutes to <code>false</code>. </td>
</tr><tr><td>
<code>expect_error</code> </td>
<td> <code>CATCH_CHECK_THROWS</code> </td>
<td> Test that evaluation of an expression throws an exception. </td>
</tr><tr><td>
<code>expect_error_as</code> </td>
<td> <code>CATCH_CHECK_THROWS_AS</code> </td>
<td> Test that evaluation of an expression throws an exception of a specific class. </td>
</tr></table>
    <p>In general, you should prefer using the <code>testthat</code>
wrappers, as <code>testthat</code> also does some work to
ensure that any unit tests within will not be compiled or
run when using the Solaris Studio compilers (as these are
currently unsupported by Catch). This should make it
easier to submit packages to CRAN that use Catch.</p>
    
    <h2 class="hasAnchor" id="advanced-usage"><a class="anchor" href="#advanced-usage"></a>Advanced Usage</h2>

    
    <p>If you'd like to write your own Catch test runner, you can
instead use the <code>testthat::catchSession()</code> object in a file
with the form:</p><pre>
#define TESTTHAT_TEST_RUNNER
#include &lt;testthat.h&gt;
    void run()
{
    Catch::Session&amp; session = testthat::catchSession();
    // interact with the session object as desired
}
</pre>
    <p>This can be useful if you'd like to run your unit tests
with custom arguments passed to the Catch session.</p>
    
    <h2 class="hasAnchor" id="standalone-usage"><a class="anchor" href="#standalone-usage"></a>Standalone Usage</h2>

    
    <p>If you'd like to use the C++ unit testing facilities provided
by Catch, but would prefer not to use the regular <code>testthat</code>
<span style="R">R</span> testing infrastructure, you can manually run the unit tests
by inserting a call to:</p><pre>
.Call("run_testthat_tests", PACKAGE = &lt;pkgName&gt;)
</pre>
    <p>as necessary within your unit test suite.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <p><a href='https://github.com/philsquared/Catch'>Catch</a>, the
library used to enable C++ unit testing.</p>
    

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#details">Details</a></li>

      <li><a href="#functions">Functions</a></li>

      <li><a href="#advanced-usage">Advanced Usage</a></li>

      <li><a href="#standalone-usage">Standalone Usage</a></li>

      <li><a href="#see-also">See also</a></li>
          </ul>

  </div>
</div>

      <footer>
      <div class="tidyverse">
  <p>testthat is a part of the <strong>tidyverse</strong>, an ecosystem of packages designed with common APIs and a shared philosophy. Learn more at <a href="http://tidyverse.org">tidyverse.org</a>.</p>
</div>

<div class="author">
  <p>Developed by <a href='http://hadley.nz'>Hadley Wickham</a>, <a href='https://www.rstudio.com'><img src='http://tidyverse.org/rstudio-logo.svg' height='24' /></a>.</p>
  <p>Site built by <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-67989-18', 'auto');
  ga('send', 'pageview');
</script>
      </footer>
   </div>

  </body>
</html>
